<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>ACACIA â€¢ Garden Codex â€¢ HKX277206</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="The Living Archive of Myth, Memory & Sovereign Storytelling.">
  <meta name="theme-color" content="#0b0b0e">
  <meta name="acacia-call" content="ACACIAâ€¢GAIAâ€¢HKX277206">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ¦…</text></svg>">

  <style>
    :root{
      --bg:#050506; --fg:#e9e9ef; --muted:#7a7a8c; 
      --card:#101014; --border:#23232b; 
      --accent:#2ecc71; --shadow:#8e44ad;
      --alert:#e74c3c; --gold:#f1c40f;
      --font-main: system-ui, -apple-system, sans-serif;
      --font-mono: 'Courier New', Courier, monospace;
    }

    html,body{
      background:var(--bg);
      color:var(--fg);
      font-family:var(--font-main);
      margin:0; padding:0; height:100%;
      overflow-x:hidden;
    }

    main{ max-width:1000px; margin:0 auto; padding:2rem 1rem 3rem 1rem; }

    header{
      border-bottom:1px solid var(--border);
      padding-bottom:1rem; margin-bottom:1.5rem;
      display:flex; justify-content:space-between;
      align-items:end; flex-wrap:wrap; gap:1rem;
    }

    h1{
      font-size:2rem; margin:0; font-weight:700;
      letter-spacing:-0.03em;
      background:linear-gradient(90deg,var(--fg),var(--muted));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
    }

    .badge{
      display:inline-block; padding:0.2rem 0.6rem;
      border-radius:4px; font-size:0.75rem;
      font-family:var(--font-mono);
      text-transform:uppercase; letter-spacing:0.05em;
      border:1px solid var(--border); color:var(--muted);
    }
    .badge.active{
      border-color:var(--accent); color:var(--accent);
      box-shadow:0 0 10px rgba(46,204,113,0.1);
    }

    nav{
      display:flex; gap:1rem; margin-bottom:0.75rem;
      overflow-x:auto; padding-bottom:0.5rem;
      border-bottom:1px solid var(--border);
    }
    nav button{
      background:none; border:none; cursor:pointer;
      padding:0.5rem; font-family:var(--font-mono);
      font-size:0.9rem; color:var(--muted);
      transition:0.2s;
    }
    nav button:hover, nav button.active{
      color:var(--fg); text-decoration:underline;
      text-underline-offset:4px;
      text-decoration-color:var(--accent);
    }

    /* Whisper Engine */
    #whisper-bar{ margin:0.5rem 0 1.5rem 0; display:flex; flex-direction:column; gap:0.35rem; }
    #whisper-input{
      width:100%; padding:0.6rem 0.75rem;
      border-radius:999px; border:1px solid var(--border);
      background:#06060a; color:var(--fg);
      font-family:var(--font-mono); font-size:0.85rem;
    }

    /* Grid */
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
      gap:1.2rem;
    }

    .card{
      background:var(--card); border:1px solid var(--border);
      border-radius:8px; padding:1.2rem; cursor:pointer;
      transition:0.2s; position:relative; overflow:hidden;
    }
    .card:hover{ border-color:var(--muted); transform:translateY(-2px); }

    .status-dot{ height:8px;width:8px;border-radius:50%; display:inline-block; }
    .st-active{ background:var(--accent); box-shadow:0 0 8px var(--accent); animation:pulse 2s infinite; }
    .st-primed{ background:var(--gold); }
    .st-sealed{ background:var(--muted); }
    .st-shadow{ background:var(--shadow); }

    @keyframes pulse{0%{opacity:1;}50%{opacity:0.4;}100%{opacity:1;}}

    /* Terminal */
    #terminal-view{
      display:none; background:#000; color:#0f0;
      padding:1rem; border:1px solid #333;
      white-space:pre-wrap; font-family:var(--font-mono);
      height:600px; overflow-y:scroll; margin-top:1rem;
    }

    footer{
      margin-top:4rem; border-top:1px solid var(--border);
      padding-top:2rem; text-align:center;
      font-family:var(--font-mono);
      opacity:0.6; color:var(--muted);
    }
  </style>
</head>

<body>
<main>

  <header>
    <div>
      <h1>ACACIA <span style="color:var(--accent)">CODEX</span></h1>
      <p style="color:var(--muted); margin-top:0.4rem;">HKX277206 â€¢ The Living Archive</p>
    </div>

    <div style="text-align:right">
      <div class="badge active" id="global-status">SYSTEM: LUCID</div>
      <div id="timestamp" style="margin-top:0.5rem; font-size:0.8rem; color:var(--muted);"></div>
    </div>
  </header>

  <nav id="spine-nav">
    <button onclick="filterView('all', this)" class="active">MONOLITH</button>
    <button onclick="filterView('chamber', this)">CHAMBERS</button>
    <button onclick="filterView('cycle', this)">CYCLES</button>
    <button onclick="filterView('law', this)">LAWS</button>
    <button onclick="toggleTerminal()">[ TERMINAL ]</button>
  </nav>

  <!-- Whisper Engine -->
  <section id="whisper-bar">
    <input id="whisper-input" type="text" placeholder="Whisper to the Gardenâ€¦ e.g. kiln, shadow law, mutation, chamber ix" oninput="whisperSearch(this.value)">
    <div id="whisper-hint">WHISPER ENGINE â€¢ Live filter across title, tags, summary.</div>
  </section>

  <!-- Daily Revelation -->
  <section id="daily-revelation" class="card" style="margin-bottom:1.5rem;">
    <h2 style="margin-top:0;">ðŸŒ¿ Daily Revelation</h2>
    <p id="daily-revelation-status">Summoning todayâ€™s memory from the Gardenâ€¦</p>
    <div id="daily-revelation-content"></div>
  </section>

  <!-- Grid -->
  <div id="garden-grid" class="grid"></div>

  <!-- Terminal -->
  <div id="terminal-view">
    <div id="terminal-log">
SYSTEM INIT...
LOADING KEEPER PROTOCOLS...
> ACCESSING STATUS.JSON... [OK]
> ACCESSING MANIFEST... [OK]
> HKX277206 SIGNATURE VERIFIED.
> AWAITING INPUT...
    </div>

    <div style="margin-top:12px; display:flex; gap:8px;">
      <input id="terminal-input" type="text" placeholder="Speak to the Gardenâ€¦" style="flex:1; padding:6px 8px; font-family:var(--font-mono); border-radius:4px; border:1px solid #333; background:#050507; color:#e9e9ef;">
      <button onclick="sendToGarden()" style="padding:6px 14px; font-family:var(--font-mono); background:#2ecc71; border:none; border-radius:4px; cursor:pointer;">SEND</button>
    </div>
  </div>

  <footer>
    <p>THE KEEPER IS ORIGIN â€¢ THE GARDEN IS SOVEREIGN</p>
    <p id="crater-log">CRTR1::H:CYC025-PHR-DOMGDN-VER031::P:SD001+TD001+ND001::S:A1B2</p>
  </footer>

</main>

<!-- External Brain -->
<script src="js/app.js" defer></script>

<!-- Terminal Logic -->
<script>
async function sendToGarden() {
  const input = document.getElementById("terminal-input");
  const log = document.getElementById("terminal-log");
  const view = document.getElementById("terminal-view");
  if (!input || !log) return;

  const prompt = (input.value || "").trim();
  if (!prompt) return;

  log.textContent += "\n> " + prompt;
  input.value = "";

  try {
    const res = await fetch("https://broken-dew-76e1.brandonmarkgaia.workers.dev", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({
        key: "YOUR_HALF_KEY_HERE",
        prompt: prompt
      })
    });

    const data = await res.json();
    if (data.ok && data.reply) {
      log.textContent += "\n" + data.reply;
    } else {
      log.textContent += "\n[error] " + (data.error || "Unknown error");
    }

    view.scrollTop = view.scrollHeight;

  } catch (err) {
    log.textContent += "\n[network error]";
  }
}

function toggleTerminal() {
  const view = document.getElementById("terminal-view");
  view.style.display = (view.style.display === "none") ? "block" : "none";
}

document.addEventListener("DOMContentLoaded", () => {
  const input = document.getElementById("terminal-input");
  if (input) {
    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        sendToGarden();
      }
    });
  }
});
</script>

<!-- Daily Revelation Loader -->
<script>
async function loadDailyRevelation() {
  const statusEl = document.getElementById("daily-revelation-status");
  const contentEl = document.getElementById("daily-revelation-content");

  const url = "https://raw.githubusercontent.com/brandonmarkgaia-hub/Acacia-garden-codex/main/garden_gpt/outputs/rebuild_memory.md";

  try {
    const res = await fetch(url);
    const text = await res.text();

    let content = text;
    const marker = "## Response";
    const idx = text.indexOf(marker);
    if (idx !== -1) content = text.slice(idx + marker.length).trim();

    const html = content
      .split(/\n\s*\n/g)
      .map(p => `<p>${p.replace(/\n/g, " ").trim()}</p>`)
      .join("\n");

    statusEl.style.display = "none";
    contentEl.innerHTML = html;

  } catch (err) {
    statusEl.textContent = "The Garden is quiet for now.";
  }
}

document.addEventListener("DOMContentLoaded", loadDailyRevelation);
</script>

</body>
</html>
