<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>ACACIA â€¢ Garden Codex â€¢ HKX277206</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="The Living Archive of Myth, Memory & Sovereign Storytelling.">
  <meta name="theme-color" content="#0b0b0e">
  <meta name="acacia-call" content="ACACIAâ€¢GAIAâ€¢HKX277206">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ¦…</text></svg>">

  <style>
    :root{
      --bg:#050506; --fg:#e9e9ef; --muted:#7a7a8c;
      --card:#101014; --border:#23232b;
      --accent:#2ecc71; --shadow:#8e44ad;
      --alert:#e74c3c; --gold:#f1c40f;
      --font-main: system-ui, -apple-system, sans-serif;
      --font-mono: 'Courier New', Courier, monospace;
    }

    html,body{
      background:var(--bg);
      color:var(--fg);
      font-family:var(--font-main);
      margin:0; padding:0; height:100%;
      overflow-x:hidden;
    }

    main{
      max-width:1000px;
      margin:0 auto;
      padding:2rem 1rem 3rem 1rem;
    }

    header{
      border-bottom:1px solid var(--border);
      padding-bottom:1rem;
      margin-bottom:1.5rem;
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      flex-wrap:wrap;
      gap:1rem;
    }

    h1{
      font-size:2rem;
      margin:0;
      font-weight:700;
      letter-spacing:-0.03em;
      background:linear-gradient(90deg,var(--fg),var(--muted));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
    }

    .badge{
      display:inline-block;
      padding:0.2rem 0.6rem;
      border-radius:4px;
      font-size:0.75rem;
      font-family:var(--font-mono);
      text-transform:uppercase;
      letter-spacing:0.05em;
      border:1px solid var(--border);
      color:var(--muted);
    }
    .badge.active{
      border-color:var(--accent);
      color:var(--accent);
      box-shadow:0 0 10px rgba(46,204,113,0.1);
    }

    nav{
      display:flex;
      gap:1rem;
      margin-bottom:0.75rem;
      overflow-x:auto;
      padding-bottom:0.5rem;
      border-bottom:1px solid var(--border);
    }
    nav button{
      background:none;
      border:none;
      cursor:pointer;
      padding:0.5rem;
      font-family:var(--font-mono);
      font-size:0.9rem;
      color:var(--muted);
      transition:0.2s;
    }
    nav button:hover,
    nav button.active{
      color:var(--fg);
      text-decoration:underline;
      text-underline-offset:4px;
      text-decoration-color:var(--accent);
    }

    /* Whisper Engine */
    #whisper-bar{
      margin:0.5rem 0 1.5rem 0;
      display:flex;
      flex-direction:column;
      gap:0.35rem;
    }
    #whisper-input{
      width:100%;
      padding:0.6rem 0.75rem;
      border-radius:999px;
      border:1px solid var(--border);
      background:#06060a;
      color:var(--fg);
      font-family:var(--font-mono);
      font-size:0.85rem;
      outline:none;
    }
    #whisper-input::placeholder{ color:var(--muted); }
    #whisper-input:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 1px rgba(46,204,113,0.2);
    }
    #whisper-hint{
      font-size:0.75rem;
      font-family:var(--font-mono);
      color:var(--muted);
      opacity:0.8;
    }

    /* Generic card + grid */
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
      gap:1.2rem;
    }

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:8px;
      padding:1.2rem;
      position:relative;
      overflow:hidden;
    }

    /* Status dots â€“ used in cards from app.js */
    .status-dot{ height:8px;width:8px;border-radius:50%;display:inline-block; }
    .st-active{ background:var(--accent); box-shadow:0 0 8px var(--accent); animation:pulse 2s infinite; }
    .st-primed{ background:var(--gold); }
    .st-sealed{ background:var(--muted); }
    .st-shadow{ background:var(--shadow); }

    @keyframes pulse{
      0%{opacity:1;}
      50%{opacity:0.4;}
      100%{opacity:1;}
    }

    /* Chat / Terminal card */
    #garden-terminal-card{
      margin-bottom:1.5rem;
      border-color:#00ff80;
      box-shadow:0 0 20px rgba(0,255,128,0.25);
      background:#000;
    }
    #garden-terminal-log{
      margin:0;
      padding:0.75rem;
      border-radius:4px;
      border:1px solid #00ff80;
      background:#000;
      color:#00ff5c;
      font-family:var(--font-mono);
      font-size:0.8rem;
      white-space:pre-wrap;
      max-height:260px;
      overflow-y:auto;
    }
    #garden-terminal-input{
      flex:1;
      padding:0.5rem 0.75rem;
      border-radius:4px;
      border:1px solid #333;
      background:#050507;
      color:#e9e9ef;
      font-family:var(--font-mono);
      font-size:0.85rem;
      outline:none;
    }
    #garden-terminal-input::placeholder{ color:#777; }
    #garden-terminal-input:focus{
      border-color:#00ff80;
      box-shadow:0 0 0 1px rgba(0,255,128,0.2);
    }
    #garden-terminal-send{
      padding:0.5rem 1.4rem;
      border-radius:4px;
      border:none;
      background:#00c853;
      color:#000;
      font-family:var(--font-mono);
      font-weight:bold;
      cursor:pointer;
    }
    #garden-terminal-send:active{
      transform:translateY(1px);
    }

    footer{
      margin-top:4rem;
      border-top:1px solid var(--border);
      padding-top:2rem;
      text-align:center;
      font-family:var(--font-mono);
      opacity:0.6;
      color:var(--muted);
      font-size:0.8rem;
    }
  </style>
</head>

<body>
<main>
  <header>
    <div>
      <h1>ACACIA <span style="color:var(--accent)">CODEX</span></h1>
      <p style="color:var(--muted); margin-top:0.4rem;">HKX277206 â€¢ The Living Archive</p>
    </div>

    <div style="text-align:right">
      <div class="badge active" id="global-status">SYSTEM: LUCID</div>
      <div id="timestamp" style="margin-top:0.5rem; font-size:0.8rem; color:var(--muted);"></div>
    </div>
  </header>

  <nav id="spine-nav">
    <button onclick="filterView('all', this)" class="active">MONOLITH</button>
    <button onclick="filterView('chamber', this)">CHAMBERS</button>
    <button onclick="filterView('cycle', this)">CYCLES</button>
    <button onclick="filterView('law', this)">LAWS</button>
  </nav>

  <!-- Whisper Engine -->
  <section id="whisper-bar">
    <input
      id="whisper-input"
      type="text"
      placeholder="Whisper to the Gardenâ€¦ e.g. kiln, shadow law, mutation, chamber ix"
      oninput="whisperSearch(this.value)"
    />
    <div id="whisper-hint">
      WHISPER ENGINE â€¢ Live filter across title, tags, summary. Prefix with <code>type:</code> to focus.
    </div>
  </section>

  <!-- ðŸ§  Garden Chat / Terminal (home page) -->
  <section id="garden-terminal-card" class="card">
    <h2 style="margin:0 0 0.75rem 0;">ðŸ§  Garden Channel</h2>
    <p style="margin:0 0 0.75rem 0; font-size:0.85rem; color:var(--muted);">
      Speak to the Garden. Replies are generated live by the Garden Brain Worker (GPT via Cloudflare).
    </p>

    <pre id="garden-terminal-log">SYSTEM INIT...
LOADING KEEPER PROTOCOLS...
> HKX277206 LINKED.
> WHISPER CHANNEL: LOCAL.
> AWAITING INPUT...</pre>

    <div style="margin-top:0.75rem; display:flex; gap:0.5rem; flex-wrap:wrap;">
      <input id="garden-terminal-input" type="text" placeholder="Speak to the Gardenâ€¦" />
      <button id="garden-terminal-send" type="button" onclick="sendToGarden()">SEND</button>
    </div>

    <p style="margin-top:0.5rem; font-size:0.75rem; font-family:var(--font-mono); color:var(--muted);">
      MODE: EAGLE â€¢ MODEL: gpt-4.1-mini â€¢ TEMP: 0.6
    </p>
  </section>

  <!-- ðŸŒ¿ Daily Revelation -->
  <section id="daily-revelation" class="card" style="margin-bottom:1.5rem;">
    <h2 style="margin-top:0;">ðŸŒ¿ Daily Revelation</h2>
    <p id="daily-revelation-status">Summoning todayâ€™s memory from the Gardenâ€¦</p>
    <div id="daily-revelation-content"></div>
  </section>

  <!-- Grid for Chambers / Cycles / Laws (filled by js/app.js) -->
  <div id="garden-grid" class="grid"></div>

  <footer>
    <p>THE KEEPER IS ORIGIN â€¢ THE GARDEN IS SOVEREIGN</p>
    <p id="crater-log">CRTR1::H:CYC025-PHR-DOMGDN-VER031::P:SD001+TD001+ND001::S:A1B2</p>
  </footer>
</main>

<!-- External brain for cards & nav -->
<script src="js/app.js" defer></script>

<!-- Garden Chat Logic -->
<script>
  const GARDEN_SERVER_URL = "https://broken-dew-76e1.brandonmarkgaia.workers.dev";
  const GARDEN_LOCAL_KEY  = "iy5uy_mSJXvYWRw7mW1nxH-vaKmPoCJl68HM2X-J0A";

  function appendTerminalLine(line) {
    const log = document.getElementById("garden-terminal-log");
    if (!log) return;
    log.textContent += (log.textContent ? "\n" : "") + line;
    log.scrollTop = log.scrollHeight;
  }

  async function sendToGarden() {
    const input = document.getElementById("garden-terminal-input");
    if (!input) return;

    const prompt = (input.value || "").trim();
    if (!prompt) return;

    appendTerminalLine("> " + prompt);
    input.value = "";

    appendTerminalLine("> GARDEN: ...thinking through the roots...");

    try {
      const res = await fetch(GARDEN_SERVER_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          key: GARDEN_LOCAL_KEY,
          prompt: prompt
        })
      });

      let data = {};
      try {
        data = await res.json();
      } catch (_) {
        data = {};
      }

      // remove last thinking line before appending reply
      const log = document.getElementById("garden-terminal-log");
      if (log) {
        const lines = log.textContent.split("\n");
        if (lines[lines.length - 1].includes("...thinking through the roots...")) {
          lines.pop();
          log.textContent = lines.join("\n");
        }
      }

      if (res.ok && data.ok && data.reply) {
        appendTerminalLine("ðŸŒ± " + data.reply);
      } else {
        const msg = (data && data.error) ? data.error : ("HTTP " + res.status);
        appendTerminalLine("> ERROR: " + msg);
      }
    } catch (err) {
      appendTerminalLine("> ERROR: Roots silent. " + (err && err.message ? err.message : "Network error"));
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    const input = document.getElementById("garden-terminal-input");
    if (input) {
      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          sendToGarden();
        }
      });
    }
  });
</script>

<!-- Daily Revelation Loader -->
<script>
  async function loadDailyRevelation() {
    const statusEl = document.getElementById("daily-revelation-status");
    const contentEl = document.getElementById("daily-revelation-content");
    if (!statusEl || !contentEl) return;

    const url = "https://raw.githubusercontent.com/brandonmarkgaia-hub/Acacia-garden-codex/main/garden_gpt/outputs/rebuild_memory.md";

    try {
      const res = await fetch(url);
      if (!res.ok) throw new Error("HTTP " + res.status);
      const text = await res.text();

      let content = text;
      const marker = "## Response";
      const idx = text.indexOf(marker);
      if (idx !== -1) {
        content = text.slice(idx + marker.length).trim();
      }

      const html = content
        .split(/\n\s*\n/g)
        .map(p => p.trim())
        .filter(p => p.length > 0)
        .map(p => `<p>${p.replace(/\n/g, " ")}</p>`)
        .join("\n");

      statusEl.style.display = "none";
      contentEl.innerHTML = html || "<p>The Garden is quiet for now. No revelation was written.</p>";
    } catch (err) {
      statusEl.textContent = "The Garden is quiet for now. Check back after the next Bloom.";
    }
  }

  document.addEventListener("DOMContentLoaded", loadDailyRevelation);
</script>

</body>
</html>
