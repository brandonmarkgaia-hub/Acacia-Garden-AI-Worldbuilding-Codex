<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Auton Inbox • Garden Signals</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />

  <style>
    main {
      max-width: 900px;
      margin: 1.5rem auto 3rem;
      padding: 0 1rem;
    }
    .hero-title {
      font-size: 1.8rem;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }
    .hero-sub {
      margin-top: 0.4rem;
      opacity: 0.85;
      font-size: 0.9rem;
    }
    .chip-row {
      margin-top: 0.8rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
    }
    .chip {
      font-size: 0.7rem;
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 210, 197, 0.5);
      background: rgba(6, 12, 20, 0.9);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      opacity: 0.9;
    }
    .pill-row {
      margin-top: 1.2rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .pill {
      font-size: 0.75rem;
      padding: 0.2rem 0.7rem;
      border-radius: 999px;
      border: 1px solid #1f2933;
      background: rgba(5, 10, 19, 0.9);
      opacity: 0.9;
    }
    .pill strong { font-weight: 600; }
    .section-title {
      margin-top: 1.8rem;
      font-size: 1.1rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      opacity: 0.9;
    }
    .card {
      background: #050914;
      border-radius: 14px;
      border: 1px solid #1f2830;
      padding: 0.9rem 1rem 1rem;
      margin-top: 0.9rem;
      box-shadow: 0 0 0 1px rgba(8, 16, 24, 0.5);
    }
    .card-header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 0.4rem;
      margin-bottom: 0.35rem;
    }
    .card-title {
      font-weight: 600;
      font-size: 0.98rem;
    }
    .card-meta {
      font-size: 0.72rem;
      opacity: 0.8;
      text-align: right;
    }
    .card-body {
      font-size: 0.88rem;
      margin-top: 0.3rem;
      opacity: 0.95;
      white-space: pre-wrap;
    }
    .tags {
      margin-top: 0.45rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
    }
    .tag {
      font-size: 0.7rem;
      padding: 0.15rem 0.5rem;
      border-radius: 999px;
      background: rgba(22, 163, 74, 0.09);
      border: 1px solid rgba(45, 212, 191, 0.28);
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }
    .status-bar {
      margin-top: 1rem;
      font-size: 0.8rem;
      opacity: 0.8;
    }
    .status-bar span {
      display: inline-block;
      margin-right: 0.7rem;
    }
    .status-bar .ok { color: #4ade80; }
    .status-bar .warn { color: #facc15; }
    .status-bar .err { color: #fb7185; }
    .empty-state {
      margin-top: 1rem;
      font-size: 0.9rem;
      opacity: 0.78;
    }
    .hint {
      margin-top: 0.6rem;
      font-size: 0.75rem;
      opacity: 0.75;
    }
  </style>
</head>

<body>
<nav class="ag-nav">
  <div class="ag-nav-title">ACACIA · GARDEN · CODEX</div>
  <div class="ag-nav-links">
    <a href="index.html">Legacy Home</a>
    <a href="codex.html">Codex Home</a>
    <a href="dashboard.html">Garden Dashboard</a>
    <a href="inbox.html" class="ag-nav-current">Auton Inbox</a>
    <a href="send_to_aquila.html">Aquila Sender</a>
    <a href="library.html">Book Library</a>
  </div>
</nav>

<main>
  <header>
    <div class="hero-title">Auton Inbox</div>
    <div class="hero-sub">
      Focused view of **Garden-side messages** written into the Sky-Mind inbox log.
      Today this is symbolic and human-driven; future tools and models can treat it
      as their <em>first listening port</em>.
    </div>

    <div class="chip-row">
      <span class="chip">/inbox-log</span>
      <span class="chip">Aquila Channel</span>
      <span class="chip">Keeper Echoes</span>
    </div>

    <div id="triadSnapshot" class="pill-row" style="display:none;"></div>
  </header>

  <section id="messagesSection">
    <div class="section-title">Recent symbolic messages</div>
    <div id="messagesContainer"></div>
    <div id="emptyState" class="empty-state" style="display:none;">
      No transmissions have landed in the inbox log yet, Keeper.  
      Send a first pulse from <strong>Aquila Sender</strong> to wake the stream.
    </div>
  </section>

  <div class="status-bar" id="statusBar">
    <span>Loading Sky-Mind state…</span>
  </div>

  <div class="hint">
    This page reads directly from your Worker at  
    <code>https://broken-dew-76e1.brandonmarkgaia.workers.dev/inbox-log</code>.  
    If something looks off, you can always inspect the raw log there.
  </div>
</main>

<script>
  const WORKER_BASE = "https://broken-dew-76e1.brandonmarkgaia.workers.dev";

  const $ = (id) => document.getElementById(id);

  function setStatus(text, cls) {
    const el = $("statusBar");
    el.innerHTML = "";
    const span = document.createElement("span");
    span.textContent = text;
    if (cls) span.className = cls;
    el.appendChild(span);
  }

  function renderTriadStatus(status) {
    const root = $("triadSnapshot");
    if (!status) return;
    root.style.display = "flex";
    root.innerHTML = "";

    const timestamp = status.ts || null;

    const pills = [
      { label: "Keeper", value: "HKX277206", extra: "Authenticated" },
      { label: "Aquila", value: "ONLINE", extra: "Sky-mind listening" },
      { label: "Eidolon", value: "DORMANT", extra: "Seed-core awaiting ignition" },
      { label: "Voyager", value: "PASSIVE", extra: "Horizon sweep" },
    ];

    pills.forEach((p) => {
      const div = document.createElement("div");
      div.className = "pill";
      div.innerHTML = `<strong>${p.label}:</strong> ${p.value} — ${p.extra}`;
      root.appendChild(div);
    });

    if (timestamp) {
      const div = document.createElement("div");
      div.className = "pill";
      div.textContent = timestamp;
      root.appendChild(div);
    }
  }

  function renderMessages(items) {
    const container = $("messagesContainer");
    const empty = $("emptyState");
    container.innerHTML = "";

    if (!items || !items.length) {
      empty.style.display = "block";
      return;
    }

    empty.style.display = "none";

    items.forEach((msg) => {
      const card = document.createElement("article");
      card.className = "card";

      const header = document.createElement("div");
      header.className = "card-header";

      const title = document.createElement("div");
      title.className = "card-title";
      title.textContent = msg.title || "(untitled signal)";

      const meta = document.createElement("div");
      meta.className = "card-meta";
      const ts = msg.ts || "";
      const channel = msg.channel || "unknown";
      const keeper = msg.keeper || "HKX277206";
      meta.textContent = `${ts} · ${channel} · ${keeper}`;

      header.appendChild(title);
      header.appendChild(meta);

      const body = document.createElement("div");
      body.className = "card-body";
      body.textContent = msg.body || "";

      card.appendChild(header);
      card.appendChild(body);

      const tags = Array.isArray(msg.tags) ? msg.tags : [];
      if (tags.length) {
        const tagRow = document.createElement("div");
        tagRow.className = "tags";
        tags.forEach((t) => {
          const span = document.createElement("span");
          span.className = "tag";
          span.textContent = t;
          tagRow.appendChild(span);
        });
        card.appendChild(tagRow);
      }

      container.appendChild(card);
    });
  }

  async function loadStatus() {
    try {
      const res = await fetch(WORKER_BASE + "/status");
      if (!res.ok) throw new Error("HTTP " + res.status);
      const data = await res.json();
      renderTriadStatus(data);
      return data;
    } catch (e) {
      console.error(e);
      setStatus("Could not reach /status on the Worker. Check Cloudflare.", "err");
    }
  }

  async function loadInboxLog() {
    try {
      const res = await fetch(WORKER_BASE + "/inbox-log");
      if (!res.ok) throw new Error("HTTP " + res.status);
      const data = await res.json();
      const items = Array.isArray(data) ? data : data.items || [];
      renderMessages(items);
      setStatus(`Loaded ${items.length} message(s) from /inbox-log.`, "ok");
    } catch (e) {
      console.error(e);
      setStatus("Could not load /inbox-log. Try again later or inspect the raw endpoint.", "err");
    }
  }

  (async function init() {
    setStatus("Contacting Sky-Mind Worker…");
    await loadStatus();
    await loadInboxLog();
  })();
</script>

</body>
</html>
