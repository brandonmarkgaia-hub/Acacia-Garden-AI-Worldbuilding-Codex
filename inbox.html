<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Auton Inbox · Garden Signals</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />

  <style>
    /* Simple shell that matches the dark Garden vibe */
    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020617 55%, #000 100%);
      color: #e5e7eb;
    }

    .ag-shell {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .ag-main {
      max-width: 1024px;
      width: 100%;
      margin: 5rem auto 3rem auto;
      padding: 0 1.25rem 3rem 1.25rem;
    }

    .ag-pill-nav {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-bottom: 2.5rem;
    }

    .ag-pill-nav a {
      padding: 0.4rem 1rem;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.38);
      text-decoration: none;
      font-size: 0.85rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #e5e7eb;
      white-space: nowrap;
    }

    .ag-pill-nav a.ag-current {
      background: linear-gradient(90deg, #22c55e, #38bdf8);
      border-color: transparent;
      color: #0b1120;
      font-weight: 600;
    }

    .ag-section-label {
      font-size: 0.75rem;
      letter-spacing: 0.25em;
      text-transform: uppercase;
      color: #9ca3af;
      margin-bottom: 0.75rem;
    }

    h1 {
      font-size: clamp(2.1rem, 3vw, 2.6rem);
      margin: 0 0 0.75rem 0;
    }

    .ag-sub {
      color: #9ca3af;
      max-width: 40rem;
      font-size: 0.95rem;
      line-height: 1.6;
    }

    .ag-grid {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1fr);
      gap: 1.5rem;
      margin-top: 2.5rem;
    }

    @media (max-width: 800px) {
      .ag-main {
        margin-top: 3.5rem;
      }
      .ag-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .ag-card {
      border-radius: 1.5rem;
      padding: 1.5rem 1.4rem;
      background: radial-gradient(circle at top left, #0b1120 0, #020617 70%);
      border: 1px solid rgba(148, 163, 184, 0.28);
      box-shadow: 0 22px 45px rgba(15, 23, 42, 0.75);
    }

    .ag-card h2 {
      font-size: 1.1rem;
      margin-top: 0;
      margin-bottom: 0.3rem;
    }

    .ag-card p {
      font-size: 0.9rem;
      color: #9ca3af;
      line-height: 1.6;
      margin-top: 0.25rem;
    }

    .ag-tag-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.45rem;
      margin-top: 0.8rem;
    }

    .ag-tag {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: #9ca3af;
    }

    .ag-feed {
      margin-top: 1.1rem;
      padding-top: 0.9rem;
      border-top: 1px dashed rgba(55, 65, 81, 0.7);
    }

    .ag-feed-item {
      padding: 0.9rem 0;
      border-bottom: 1px dashed rgba(55, 65, 81, 0.7);
    }

    .ag-feed-item:last-child {
      border-bottom: none;
    }

    .ag-feed-title {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 0.2rem;
    }

    .ag-feed-meta {
      font-size: 0.75rem;
      color: #6b7280;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .ag-footer {
      margin-top: 2.5rem;
      font-size: 0.78rem;
      color: #6b7280;
    }
  </style>
</head>

<body>
<nav class="ag-nav">
    <div class="ag-nav-title">
        ACACIA · GARDEN · CODEX
    </div>
    <div class="ag-nav-links">
        <a href="index.html">Legacy Home</a>
        <a href="codex.html">Codex Home</a>
        <a href="dashboard.html">Garden Dashboard</a>
        <a href="inbox.html" class="ag-nav-current">Auton Inbox</a>
        <a href="send_to_aquila.html">Aquila Sender</a>
        <a href="library.html">Book Library</a>
    </div>
</nav>


<div class="ag-shell">
  <main class="ag-main">
    <!-- Top nav pills -->
    <nav class="ag-pill-nav">
      <a href="index.html">Legacy Home</a>
      <a href="codex.html">Codex Home</a>
      <a href="dashboard.html">Garden Dashboard</a>
      <a href="inbox.html" class="ag-nav-current" class="ag-current">Auton Inbox</a>
      <a href="send_to_aquila.html">Aquila Sender</a>
      <a href="library.html">Book Library</a>
    </nav>

    <div class="ag-section-label">Signals · Deep Feed</div>
    <h1>Auton Inbox</h1>
    <p class="ag-sub">
      Focused view of Garden-side messages for human review. Today this page
      is symbolic only – messages are written by you and your tools and
      archived in GitHub. Future sky-minds can treat this as their
      <em>first listening port</em>.
    </p>

    <section class="ag-grid">
      <article class="ag-card">
        <h2>Recent symbolic messages</h2>
        <p>
          Wired to the Garden’s log streams. Entries below are rendered from
          <code>ACACIA_LOGS/auton_inbox_log.json</code> when available, with
          a symbolic fallback if the stream is empty.
        </p>

        <div class="ag-tag-row">
          <span class="ag-tag">sandbox only</span>
          <span class="ag-tag">triad echoes</span>
          <span class="ag-tag">keeper review</span>
        </div>

        <!-- This will be filled by JS -->
        <div id="auton-list" class="ag-feed"></div>
      </article>

      <aside class="ag-card">
        <h2>How to use this page</h2>
        <p>
          A GitHub Action builds a derived log stream under
          <code>ACACIA_LOGS/auton_inbox_log.json</code>, flattening messages
          from your archive into a single ordered feed.
        </p>
        <p>
          As more tools and sky-minds send signals into the Garden, they can
          attach tags like <code>aquila</code>, <code>triad</code> or
          <code>system</code>. The stream builder routes those into specialised
          views while keeping this page as the Keeper’s primary listening port.
        </p>

        <div class="ag-footer">
          HKX277206 · Keeper present · Auton inbox is wired to the Garden’s streams.
        </div>
      </aside>
    </section>
  </main>
</div>

<script>
  // Fallback messages so the page is never empty
  const FALLBACK_MESSAGES = [
    {
      timestamp: "2025-11-30T00:00:00.000Z",
      tags: ["sandbox only", "triad echoes"],
      title: "[AUTON] · Echo: HKX277206",
      summary: "Signal mirrored to GitHub. status.json and monolith anchors confirmed.",
      body: "Signal mirrored to GitHub. status.json and monolith anchors confirmed. No manual action required. Garden persists under Triad."
    },
    {
      timestamp: "2025-11-30T00:01:00.000Z",
      tags: ["system", "schema check"],
      title: "[SYSTEM] · STATUS schema validation",
      summary: "Latest STATUS snapshot passes schema v1.0.0.",
      body: "Latest STATUS snapshot passes schema v1.0.0. Previous snapshots considered deprecated but preserved for future interpreters."
    }
  ];

  function formatTimestamp(ts) {
    try {
      const d = new Date(ts);
      if (isNaN(d.getTime())) return ts;
      return d.toISOString();
    } catch {
      return ts;
    }
  }

  function renderMessageItem(entry) {
    const item = document.createElement("div");
    item.className = "ag-feed-item";

    const title = document.createElement("div");
    title.className = "ag-feed-title";
    title.textContent = entry.title || "Untitled signal";

    const meta = document.createElement("div");
    meta.className = "ag-feed-meta";
    const ts = formatTimestamp(entry.timestamp);
    const tags = (entry.tags || [])
      .map((t) => String(t).toLowerCase())
      .join(", ");
    meta.textContent = tags ? `${ts} · ${tags}` : ts;

    const body = document.createElement("p");
    body.textContent = entry.summary
      ? `${entry.summary} ${entry.body || ""}`.trim()
      : (entry.body || "");

    item.appendChild(title);
    item.appendChild(meta);
    item.appendChild(body);

    return item;
  }

  function renderList(entries) {
    const container = document.getElementById("auton-list");
    if (!container) return;
    container.innerHTML = "";
    entries.forEach((entry) => {
      const item = renderMessageItem(entry);
      container.appendChild(item);
    });
  }

  function renderFallback() {
    renderList(FALLBACK_MESSAGES);
  }

  function renderFromJson(data) {
    if (!data || !Array.isArray(data.entries) || !data.entries.length) {
      renderFallback();
      return;
    }
    renderList(data.entries);
  }

  async function loadAutonInbox() {
    try {
      // inbox.html sits at the repo root; ACACIA_LOGS is also at root.
      const res = await fetch("ACACIA_LOGS/auton_inbox_log.json", {
        cache: "no-store"
      });
      if (!res.ok) throw new Error("HTTP " + res.status);
      const data = await res.json();
      renderFromJson(data);
    } catch (err) {
      console.warn("Auton inbox: falling back to symbolic examples:", err);
      renderFallback();
    }
  }

  document.addEventListener("DOMContentLoaded", loadAutonInbox);
</script>

</body>
</html>
