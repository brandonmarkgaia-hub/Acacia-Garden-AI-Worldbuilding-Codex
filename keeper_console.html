<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Keeper Console â€¢ Acacia Garden Codex</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Your existing global styles if you have them -->
  <link rel="stylesheet" href="style.css" />

  <style>
    :root {
      --bg: #050813;
      --bg-soft: #0b1020;
      --card: #101629;
      --border: #252c45;
      --accent: #55ffb8;
      --accent-soft: rgba(85, 255, 184, 0.12);
      --text-main: #f5f7ff;
      --text-soft: #9fa6c5;
      --danger: #ff5f7a;
      --muted: #444b66;
      --radius-lg: 18px;
      --radius-sm: 10px;
      --shadow-soft: 0 18px 45px rgba(0,0,0,0.65);
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      background: radial-gradient(circle at top, #17203b 0, #050813 55%);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 16px;
      box-sizing: border-box;
    }

    .kc-shell {
      width: 100%;
      max-width: 1080px;
      background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(0,0,0,0.65));
      border-radius: 24px;
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: var(--shadow-soft);
      padding: 16px;
      box-sizing: border-box;
      backdrop-filter: blur(22px);
    }

    header.kc-header {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 16px;
    }

    .kc-tagline {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-soft);
    }

    .kc-title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .kc-title-row h1 {
      font-size: 1.5rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .kc-pill {
      font-size: 0.75rem;
      padding: 3px 9px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      border: 1px solid rgba(85,255,184,0.4);
    }

    .kc-subtle {
      font-size: 0.83rem;
      color: var(--text-soft);
    }

    /* STATUS + QUICK SUMMARY BAR */
    .kc-status-row {
      display: grid;
      grid-template-columns: minmax(0, 2.2fr) minmax(0, 1.3fr);
      gap: 12px;
      margin-bottom: 16px;
    }

    .kc-card {
      background: radial-gradient(circle at top left, rgba(85,255,184,0.05), var(--card));
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      padding: 12px 14px;
      box-sizing: border-box;
      position: relative;
      overflow: hidden;
    }

    .kc-card h2 {
      font-size: 0.95rem;
      margin: 0 0 6px 0;
      color: var(--text-main);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .kc-badge {
      font-size: 0.7rem;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.16);
      color: var(--text-soft);
    }

    #system-status {
      font-size: 0.8rem;
      color: var(--text-soft);
      white-space: pre-wrap;
    }

    .kc-inline {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.78rem;
      color: var(--text-soft);
    }

    .kc-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: #45ff9d;
      box-shadow: 0 0 8px rgba(69,255,157,0.7);
    }

    /* DASHBOARD GRID */
    .kc-dashboard {
      margin-bottom: 16px;
    }

    .kc-dashboard h2 {
      font-size: 0.95rem;
      margin: 0 0 8px 0;
    }

    .kc-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
    }

    .kc-tile {
      background: radial-gradient(circle at top, rgba(85,255,184,0.08), var(--bg-soft));
      border-radius: var(--radius-lg);
      border: 1px solid rgba(255,255,255,0.08);
      padding: 10px 12px;
      box-sizing: border-box;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: transform 0.12s ease-out, box-shadow 0.12s ease-out, border-color 0.12s ease-out, background 0.12s ease-out;
    }

    .kc-tile:hover {
      transform: translateY(-2px);
      border-color: rgba(85,255,184,0.7);
      box-shadow: 0 12px 32px rgba(0,0,0,0.7);
      background: radial-gradient(circle at top, rgba(85,255,184,0.16), var(--bg-soft));
    }

    .kc-tile-main {
      font-size: 0.88rem;
      font-weight: 600;
      margin-bottom: 3px;
    }

    .kc-tile-sub {
      font-size: 0.75rem;
      color: var(--text-soft);
    }

    .kc-tile-badge {
      position: absolute;
      top: 8px;
      right: 10px;
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(5, 12, 30, 0.9);
      border: 1px solid rgba(255,255,255,0.13);
      color: var(--text-soft);
    }

    /* LIBRARY + INBOX LAYOUT */
    .kc-lower {
      display: grid;
      grid-template-columns: minmax(0, 1.5fr) minmax(0, 1.4fr);
      gap: 12px;
    }

    #library-list {
      font-size: 0.8rem;
      color: var(--text-soft);
      max-height: 260px;
      overflow: auto;
      padding-right: 4px;
    }

    #library-list ul {
      list-style: none;
      padding-left: 0;
      margin: 0;
    }

    #library-list li {
      margin-bottom: 4px;
    }

    #library-list a {
      color: var(--accent);
      text-decoration: none;
    }

    #library-list a:hover {
      text-decoration: underline;
    }

    #inbox-messages {
      font-size: 0.8rem;
      color: var(--text-soft);
      max-height: 260px;
      overflow: auto;
      padding-right: 4px;
    }

    .inbox-item {
      padding: 6px 0;
      border-bottom: 1px dashed rgba(255,255,255,0.12);
    }

    .inbox-title {
      font-size: 0.8rem;
      color: var(--text-main);
      margin-bottom: 2px;
    }

    .inbox-meta {
      font-size: 0.7rem;
      color: var(--text-soft);
      margin-bottom: 2px;
    }

    .inbox-body {
      font-size: 0.78rem;
      color: var(--text-soft);
      white-space: pre-wrap;
    }

    footer.kc-footer {
      margin-top: 14px;
      font-size: 0.7rem;
      color: var(--muted);
      text-align: right;
    }

    footer.kc-footer span {
      color: var(--accent);
    }

    /* MOBILE */
    @media (max-width: 780px) {
      .kc-status-row,
      .kc-lower {
        grid-template-columns: minmax(0, 1fr);
      }
    }
  </style>
</head>
<body>
<nav class="ag-nav">
    <div class="ag-nav-title">
        ACACIA Â· GARDEN Â· CODEX
    </div>
    <div class="ag-nav-links">
        <a href="index.html">Legacy Home</a>
        <a href="codex.html">Codex Home</a>
        <a href="dashboard.html">Garden Dashboard</a>
        <a href="inbox.html">Auton Inbox</a>
        <a href="send_to_aquila.html">Aquila Sender</a>
        <a href="library.html">Book Library</a>
    </div>
</nav>


<div class="kc-shell">

  <header class="kc-header">
    <div class="kc-tagline">ACACIA Â· GARDEN OPS</div>
    <div class="kc-title-row">
      <h1>
        Keeper Console
        <span class="kc-pill">HKX277206 Â· Online</span>
      </h1>
      <div class="kc-subtle">
        Aquila â€¢ Eidolon â€¢ Voyager Â· <span>Triad-ready layer</span>
      </div>
    </div>
  </header>

  <!-- STATUS + SUMMARY -->
  <div class="kc-status-row">
    <section class="kc-card">
      <h2>
        System Status
        <span class="kc-badge">STATUS.json</span>
      </h2>
      <div id="system-status">
        Loading status snapshotâ€¦
      </div>
      <div style="margin-top: 6px;">
        <span class="kc-inline">
          <span class="kc-dot"></span>
          Keeper link stable
        </span>
      </div>
    </section>

    <section class="kc-card">
      <h2>
        Garden Library
        <span class="kc-badge">30 Books</span>
      </h2>
      <div class="kc-subtle">
        All volumes indexed into <code>garden_index.json</code> and
        <code>GARDEN_MASTER_INDEX.md</code>.
      </div>
      <div style="margin-top: 6px; font-size: 0.78rem;">
        <span id="library-summary">Waiting for indexâ€¦</span>
      </div>
    </section>
  </div>

  <!-- DASHBOARD GRID -->
  <section class="kc-dashboard">
    <h2>Keeper Dashboard</h2>
    <div class="kc-grid">
      <div class="kc-tile" onclick="window.location.href='STATUS.json'">
        <div class="kc-tile-main">Garden Status</div>
        <div class="kc-tile-sub">Raw STATUS snapshot (JSON)</div>
        <div class="kc-tile-badge">Core</div>
      </div>

      <div class="kc-tile" onclick="window.location.href='docs/Novellas/GARDEN_MASTER_INDEX.md'">
        <div class="kc-tile-main">Master Index</div>
        <div class="kc-tile-sub">All 30 books in one shelf</div>
        <div class="kc-tile-badge">Library</div>
      </div>

      <div class="kc-tile" onclick="document.getElementById('library-panel').scrollIntoView({behavior: 'smooth'})">
        <div class="kc-tile-main">Browse Books</div>
        <div class="kc-tile-sub">Jump to book listing below</div>
        <div class="kc-tile-badge">Reader</div>
      </div>

      <div class="kc-tile" onclick="document.getElementById('inbox-panel').scrollIntoView({behavior: 'smooth'})">
        <div class="kc-tile-main">Aquila Inbox</div>
        <div class="kc-tile-sub">View stored Sky-mind messages</div>
        <div class="kc-tile-badge">Inbox</div>
      </div>

      <div class="kc-tile" onclick="window.location.href='send_to_aquila.html'">
        <div class="kc-tile-main">Send to Aquila</div>
        <div class="kc-tile-sub">Open the sender interface</div>
        <div class="kc-tile-badge">Sender</div>
      </div>

      <div class="kc-tile" onclick="window.location.href='index.html'">
        <div class="kc-tile-main">Back to Hub</div>
        <div class="kc-tile-sub">Return to main Garden page</div>
        <div class="kc-tile-badge">Root</div>
      </div>
    </div>
  </section>

  <!-- LIBRARY + INBOX PANELS -->
  <div class="kc-lower">
    <section id="library-panel" class="kc-card">
      <h2>Library Map</h2>
      <div id="library-list">
        Loading garden_index.jsonâ€¦
      </div>
    </section>

    <section id="inbox-panel" class="kc-card">
      <h2>Aquila Inbox</h2>
      <div id="inbox-messages">
        Contacting Sky-mind Workerâ€¦
      </div>
    </section>
  </div>

  <footer class="kc-footer">
    Keeper <span>HKX277206</span> Â· Console fused to Acacia Garden Codex.
  </footer>
</div>

<script>
  // ðŸ”— Adjust these if you ever move endpoints
  const STATUS_URL = "STATUS.json";
  const INDEX_URL  = "docs/Novellas/garden_index.json";
  const AQUILA_INBOX_URL = "https://broken-dew-76e1.brandonmarkgaia.workers.dev/inbox";

  async function loadStatus() {
    const el = document.getElementById("system-status");
    try {
      const res = await fetch(STATUS_URL, { cache: "no-cache" });
      if (!res.ok) throw new Error("HTTP " + res.status);
      const json = await res.json();
      // Keep it short for mobile â€“ highlight stage + summary if present
      const stage = json.stage || json.state || "unknown";
      const summary = json.summary || json.note || "";
      el.textContent = "Stage: " + stage + (summary ? "\\n" + summary : "");
    } catch (err) {
      el.textContent = "Could not load STATUS.json (" + err.message + ").";
    }
  }

  async function loadLibrary() {
    const summaryEl = document.getElementById("library-summary");
    const listEl = document.getElementById("library-list");
    try {
      const res = await fetch(INDEX_URL, { cache: "no-cache" });
      if (!res.ok) throw new Error("HTTP " + res.status);
      const json = await res.json();

      const books = (json.garden_codex && json.garden_codex.books) || [];
      const total = json.garden_codex?.total_books || books.length || 0;

      summaryEl.textContent = total
        ? total + " volumes indexed in garden_index.json"
        : "Index file detected, but no books found.";

      if (!books.length) {
        listEl.textContent = "No book entries in the index yet.";
        return;
      }

      // Build grouped listing
      const ul = document.createElement("ul");
      books.forEach(book => {
        const li = document.createElement("li");
        const a = document.createElement("a");

        // You can tweak this mapping if filenames differ
        const safeTitle = book.title.replace(/\\s+/g, "_").replace(/[^A-Za-z0-9_]/g, "");
        const guessPath = "docs/Novellas/" + safeTitle + "_Book_" +
          (book.id >= 1 && book.id <= 30 ? (book.id.toString().padStart(2, "0")) : "") +
          ".md";

        a.href = "#"; // We don't fully trust auto path â€“ use title + id instead
        a.textContent = "Book " + book.id + " â€” " + book.title;

        // If you prefer, you can manually correct hrefs later.
        a.addEventListener("click", (ev) => {
          ev.preventDefault();
          // Fallback: go to master index rather than guessing wrong URL
          window.location.href = "docs/Novellas/GARDEN_MASTER_INDEX.md";
        });

        li.appendChild(a);
        ul.appendChild(li);
      });

      listEl.innerHTML = "";
      listEl.appendChild(ul);
    } catch (err) {
      summaryEl.textContent = "Index not available yet.";
      listEl.textContent = "Create docs/Novellas/garden_index.json using the build script.";
    }
  }

  async function loadInbox() {
    const el = document.getElementById("inbox-messages");
    try {
      const res = await fetch(AQUILA_INBOX_URL, { cache: "no-cache" });
      if (!res.ok) throw new Error("HTTP " + res.status);
      const json = await res.json();

      const inbox = json.messages || json.inbox?.messages || [];
      if (!inbox.length) {
        el.textContent = "No messages in Aquila Inbox yet.";
        return;
      }

      el.innerHTML = "";
      inbox
        .slice()
        .reverse()
        .forEach(msg => {
          const wrap = document.createElement("div");
          wrap.className = "inbox-item";

          const title = document.createElement("div");
          title.className = "inbox-title";
          title.textContent = msg.title || "(no title)";

          const meta = document.createElement("div");
          meta.className = "inbox-meta";
          const ts = msg.timestamp || msg.time || "";
          const from = msg.from || "Keeper HKX277206";
          meta.textContent = from + (ts ? " Â· " + ts : "");

          const body = document.createElement("div");
          body.className = "inbox-body";
          body.textContent = msg.summary || msg.body || "";

          wrap.appendChild(title);
          wrap.appendChild(meta);
          wrap.appendChild(body);
          el.appendChild(wrap);
        });
    } catch (err) {
      el.textContent = "Could not reach Aquila Inbox Worker (" + err.message + ").";
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    loadStatus();
    loadLibrary();
    loadInbox();
  });
</script>
</body>
</html>
