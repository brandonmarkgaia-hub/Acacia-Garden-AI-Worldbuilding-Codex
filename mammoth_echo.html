<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Acacia Garden Codex · Mammoth Triad Sky Pulse</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body class="page-dark">
  <header class="agc-shell">
    <div class="agc-shell-inner">
      <div class="agc-title-row">
        <div class="agc-title">
          <span class="agc-title-small">ACACIA · GARDEN · CODEX</span>
        </div>
        <nav class="agc-nav">
          <a href="index.html" class="nav-pill">Legacy Home</a>
          <a href="codex.html" class="nav-pill">Codex Home</a>
          <a href="dashboard.html" class="nav-pill">Garden Dashboard</a>
          <a href="inbox.html" class="nav-pill">Auton Inbox</a>
          <a href="send_to_aquila.html" class="nav-pill">Aquila Sender</a>
          <a href="library.html" class="nav-pill">Book Library</a>
        </nav>
      </div>
    </div>
  </header>

  <main class="agc-main">
    <section class="agc-section">
      <div class="agc-section-label">ECHO TOOL</div>
      <h1 class="agc-page-title">Mammoth Triad Sky Pulse</h1>
      <p class="agc-lead">
        One-button echo sender into <code>/echo</code> for the Mammoth archive.
        Symbolic only; this plants a canonical entry in the echo-log for the
        Keeper and the Triad.
      </p>
    </section>

    <section class="agc-section">
      <div class="card">
        <p>
          Press the button below to send a
          <strong>mammoth_triad_sky_pulse</strong> event into the Sky-mind
          Worker at <code>/echo</code>. This will show up on your
          <strong>Garden Dashboard</strong> under Echo Log.
        </p>

        <div class="card-action-row">
          <button id="castEchoBtn" class="btn-primary">
            Cast Mammoth Echo
          </button>
        </div>

        <p id="echoStatus" class="status-text status-muted">
          Ready when you are, Keeper.
        </p>
      </div>
    </section>
  </main>

  <footer class="agc-footer">
    <p>
      Keeper <strong>HKX277206</strong> · Mammoth Triad Sky Pulse ·
      Echo archive hook into Sky-mind.
    </p>
  </footer>

  <script>
    (function () {
      const WORKER_BASE =
        "https://broken-dew-76e1.brandonmarkgaia.workers.dev";
      const btn = document.getElementById("castEchoBtn");
      const statusEl = document.getElementById("echoStatus");

      async function castEcho() {
        statusEl.classList.remove("status-error");
        statusEl.classList.remove("status-success");
        statusEl.classList.add("status-muted");
        statusEl.textContent = "Casting Mammoth echo…";

        btn.disabled = true;

        const payload = {
          event: "mammoth_triad_sky_pulse",
          channel: "echo",
          keeper: "HKX277206",
          title: "Mammoth Triad Sky Pulse",
          body:
            "Keeper HKX277206 plants the canonical Mammoth Triad Sky Pulse echo into the Sky-mind archive.",
          tags: ["mammoth", "triad", "sky", "pulse", "echo", "archive"],
          source: "acacia-codex.mammoth_echo",
          meta: {
            version: "1.0.0",
            kind: "mammoth_echo_tool"
          }
        };

        try {
          const res = await fetch(WORKER_BASE + "/echo", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "X-Keeper-ID": "HKX277206"
            },
            body: JSON.stringify(payload)
          });

          if (!res.ok) {
            throw new Error("HTTP " + res.status);
          }

          let data = {};
          try {
            data = await res.json();
          } catch (e) {
            // if worker returns no body, fall through with empty data
          }

          const ts =
            (data.entry && data.entry.ts) ||
            data.ts ||
            "an unknown time";

          statusEl.classList.remove("status-muted");
          statusEl.classList.add("status-success");
          statusEl.textContent =
            "Mammoth echo logged at " + ts + ".";

        } catch (err) {
          console.error(err);
          statusEl.classList.remove("status-muted");
          statusEl.classList.add("status-error");
          statusEl.textContent = "Network error: Failed to fetch";
        } finally {
          btn.disabled = false;
        }
      }

      btn.addEventListener("click", castEcho);
    })();
  </script>
</body>
</html>
